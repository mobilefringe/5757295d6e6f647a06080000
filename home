<!-- begin #page - the container for everything but header -->
<div id="page">	
	<!--begin slider -->
	<div class="lemmon-wrap clearfix">
		<div class="lemmon-slider">
			<ul id="blog_banner">
			     <center> <img alt="loading" style="width:250px; height:250px;" src="http://kodekloud.s3.amazonaws.com/sites/5438407c6e6f64462d020000/466b965dbf1459e8b4127cd8039f46ab/loading-1.gif"></center>
		    </ul>
		</div>
		<div class="controls"> <a href="#" class="prev-slide">Prev Page</a> <a href="#" class="next-slide">Next Page</a> </div>
		<!-- / .controls --> 
	</div>
	<!-- / end slider --> 
    <script id="blog_banner_template" type="x-tmpl-mustache">
		<li> 
			<a href="/posts/{{slug}}"> 
				<img src="{{ image_url }}" alt="" />
			</a> 
			{{#great_news}}
            	<a href="/categories/great%20news" class="sparkNowTileTag">GREAT NEWS</a>
            {{/great_news}}
			<div class="summary"> 
				<a href="/posts/{{slug}}"> 
					<p>{{ tag_first }}</p>
             		<h3>{{ title }}</h3>
				</a> 
			</div>
		</li>
    </script>
            
	<!--notice how sliders are outside the this main content div-->
	<div class="sparkNow">
		<div class="container clearfix">	
			<!-- begin equalHeights columns 3 -->
			<h3 class="short_headline sparkNowTitle"><span>The Latest</span></h3>
                <div class="row-fluid equalHero equalHeights" id="main-content">
				    <center> <img alt="loading" style="width:250px; height:250px;" src="http://kodekloud.s3.amazonaws.com/sites/5438407c6e6f64462d020000/466b965dbf1459e8b4127cd8039f46ab/loading-1.gif"></center>
				</div>
                    <script id="blog_tile_template" type="x-tmpl-mustache">
            			<div class="span6 sparkNowTile">
            				<div class="sparkNowTileTop" style="background: url({{image_url}}) no-repeat center center">
            				    {{#tag_first}}
            				        <a href="/categories/{{.}}" class="sparkNowTileTag">{{.}}</a>
                                {{/tag_first}}
            					<a href="/posts/{{slug}}" class="sparkNowTileImg">
            					</a>
            				</div>
            				<div class="sparkNowTileTitle">
            				    <a href="/posts/{{slug}}"><h3>{{ title }}</h3></a>
            				    {{#video_link}}
            				        <img src="http://kodekloud.s3.amazonaws.com/sites/5512e0606e6f64112d000000/29a93cc9dd3b7f858a31366f54bbc07b/video_icon.png" class="" alt="">
            				    {{/video_link}}
            				</div>
            				<a class="sparkNowTileRead" href="/posts/{{slug}}">READ <i class="fa fa-caret-right fa-lg"></i></a>
            			</div>
				    </script>
	   		<div class="sparkNowMore">
				<a href="javascript:void(0);" onclick="renderPostTileTemplate('#blog_tile_template', '#main-content',getPostList());">SEE MORE</a>
				<i class="fa fa-caret-down fa-lg"></i>
			</div>
		</div>
	</div>

	<!-- SPARKVIDEO -->
	<!--<div class="sparkVideo">-->
	<!--	<div class="container clearfix row-fluid"> -->
	<!--		<h3 class="short_headline sparkVideoTitle"><span><b>SPARK</b>VIDEO</span></h3>-->
	<!--		{% for post in published_video_posts limit:1 %}-->
	<!--			<div class="video-container">-->
	<!--				<iframe width="560" height="315" src="//www.youtube.com/embed/{{post.video_link}}" frameborder="0" allowfullscreen></iframe>-->
	<!--			</div>-->
	<!--			<a href="/posts/{{post.slug}}" class="sparkVideoPostTitle"><h1>{{ post.title }}</h1></a>-->
	<!--			{{ post.body }}-->
	<!--			<a class="sparkVideoRead" href="/posts/{{post.slug}}">READ</a>-->
	<!--		{% endfor %}	-->
	<!--		<div class="sparkVideoMore">-->
	<!--			<a href="/posts?tag=video">SEE MORE</a>-->
	<!--		</div>	-->
	<!--	</div>-->
	<!--</div> -->
</div>



<script>
$(document).ready(function() {
    function renderPageData(){
        renderPostSliderTemplate('#blog_banner_template', '#blog_banner',getBlogDataBySlug('ptc-blog'));
        renderPostTileTemplate('#blog_tile_template', '#main-content', getBlogDataBySlug('ptc-blog'));
        imagesLoadedEvent("img",loadSlider);
    }
    loadMallData(renderPageData);
});

function renderPosts(container, template, collection){
    var item_list = [];
    var item_rendered = [];
    var template_html = $(template).html();
    var counter = 1;
    Mustache.parse(template_html);   // optional, speeds up future uses
    $.each( collection , function( key, val ) {
        if (val.image_url.indexOf('missing.png') > -1) {
            val.post_image = "http://assets.codecloudapp.com/sites/56056be06e6f641a1d020000/image/png/1446826281000/stc-logo-holiday-360 copy.png";
        } else {
            val.post_image = val.image_url;
        }
        if(val.body.length > 100){
            val.description_short = val.body.substring(0,100) + "...";
        }
        else{
            val.description_short = val.body;
        }
        val.description_short = val.description_short.replace("&amp;", "&");
        val.slug = "posts/" +val.slug;
        var lb = getBlogDataBySlug("stc-lookbook");
        var contest = getBlogDataBySlug("stc-contest");
        var out_blog = lb.posts.concat(contest.posts);
        var id = val.id;
        var result = $.grep(out_blog, function(e){ return e.id == id; });
        if(result.length > 0){
            val.slug = val.video_link;
        }
        val.counter = counter;
        var date_blog = new Date(val.publish_date);
        console.log(val)
        val.published_on = get_month(date_blog.getMonth()) + " " + date_blog.getDate() + ", " + date_blog.getFullYear();
        
        var rendered = Mustache.render(template_html,val);
        item_rendered.push(rendered);
        counter = counter+1;
    });
    
    $(container).show();
    $(container).html(item_rendered.join(''));
}
function loadSlider(){
    $( '.lemmon-slider' ).lemmonSlider({
		infinite: true
	});
}

var interval = 4;
var totalPosts;
var showingPosts;

function checkSeeMoreButton(){
    if(totalPosts > showingPosts){
        $('.sparkNowMore').fadeIn();
    }else{
        $('.sparkNowMore').fadeOut();
    }
}



</script>